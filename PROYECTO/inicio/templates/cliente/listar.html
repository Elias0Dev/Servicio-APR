<!-- se recibe el contenido de base.html -->
{%extends 'inicio/base.html' %} {%block title%}
<!-- Se envia el titulo de la page -->
{%endblock%} {%load static%}
<!--Carga la carpeta static de la app -->

{% block js%}
<!-- Se envia la referencias al js -->
<script>
  function eliminar(id) {

    // Forzamos URL absoluta
    const url = "/cliente/eliminar_cliente/" + id + "/";

    Swal.fire({
      title: "Seguro de eliminar este cliente?",
      text: "Esta acción no se puede deshacer",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      cancelButtonText: "No, Cancelar",
      confirmButtonText: "Sí, Eliminar"
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    });
  }
</script>

{%endblock%} {% block css%}
<!-- Se envia la referencias al css -->
{%endblock%} {% block contenido%}

{%load crispy_forms_tags%}

<div class="container">
    <div style="display: flex; flex-direction: row; justify-content: space-between;">
        <h1>Listado de Clientes</h1>
        {%if perms.inicio.add_cliente%}
        <a href="{%url 'agregar_cli'%}" class="btn btn-success" >Agregar Cliente</a>
        {%endif%}
    </div>
    
    <hr>
    <table class="table table-bordered table-hover table-responsive-sm" border="1">
        <thead >
            <tr>
                <th scope="col">N° Socio</th>
                <th scope="col">Nombre</th>
                <th scope="col">Rut</th>
                <th scope="col">telefono</th>
                <th scope="col">email</th>
                <th scope="col">direccion</th>
                <th scope="col">N° de medidor</th>
                <th scope="col">Opciones</th>
            </tr>
        </thead>
    
        <tbody>
            {% for c in entity %}
                <tr>
                    <td>{{c.id_cliente}}</td>
                    <td>{{c.nombre}} {{c.apellido_paterno}} {{c.apellido_materno}}</td>
                    <td>{{c.rut}}-{{c.dv}}</td>
                    <td>{{c.telefono}}</td>
                    <td><a href="mailto:{{c.email}}">{{c.email}}</a></td>
                    <td>{{c.direccion}}</td>
                    <td>{{c.numero_medidor}}</td>
                    <td class="d-flex justify-content-center gap-2">
                      {%if perms.inicio.change_cliente%}
                      <a href="{% url 'modificar_cli' c.id_cliente %}" class="btn btn-info btn-sm">Modificar</a>
                      {%endif%}
                      {%if perms.inicio.delete_cliente%}
                      <a href="#" onclick="eliminar('{{ c.id_cliente }}')" class="btn btn-danger btn-sm">Eliminar</a>
                      {%endif%}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    
</table>
<div>
  {%include 'paginator.html'%}
</div>
</div>

{%endblock%}